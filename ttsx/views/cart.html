<div class="search_bar clearfix">
    <a href="/showindex" class="logo fl"><img src="/static/images/logo.png"></a>
    <div class="sub_page_name fl">|&nbsp;&nbsp;&nbsp;&nbsp;购物车</div>
    <div class="search_con fr">
        <input type="text" class="input_text fl" name="" placeholder="搜索商品">
        <input type="button" class="input_btn fr" name="" value="搜索">
    </div>
</div>
<div class="total_count">全部商品<em>2</em>件</div>
<ul class="cart_list_th clearfix">
    <li class="col01">商品名称</li>
    <li class="col02">商品单位</li>
    <li class="col03">商品价格</li>
    <li class="col04">数量</li>
    <li class="col05">小计</li>
    <li class="col06">操作</li>
</ul>
        {{range .goods}}
<ul class="cart_list_td clearfix">
    <li class="col01"><input type="checkbox" name="" checked></li>
    <li class="col02"><img src="http://192.168.110.111:8888/{{.goodsSku.Image}}"></li>
    <li class="col03">{{.goodsSku.Name}}<br><em>{{.goodsSku.Price}}/{{.goodsSku.Unite}}</em></li>
    <li class="col04">{{.goodsSku.Unite}}</li>
    <li class="col05">{{.goodsSku.Price}}</li>
    <li class="col06">
        <div class="num_add">
            <a href="javascript:;" class="add fl">+</a>
            <input type="text" class="num_show fl" skuid="{{.goodsSku.Id}}" value="{{.count}}">
            <a href="javascript:;" class="minus fl">-</a>
        </div>
    </li>
    <li class="col07">{{.price}}元</li>
    <li class="col08"><a href="javascript:;">删除</a></li>
</ul>
{{end}}



<ul class="settlements">
    <li class="col01"><input type="checkbox" name="checkbox" checked=""></li>
    <li class="col02">全选</li>
    <li class="col03">合计(不含运费)：<span>¥</span><em>{{.totalprice}}</em><br>共计<b>{{.totalcount}}</b>件商品</li>
    <li class="col04"><a href="place_order.html">去结算</a></li>
</ul>
<script type="text/javascript" src="/static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript">

    function updateprice(){
        totalprice1=0
        totalcount1=0
        $('.cart_list_td').find(':checked').parents('ul').each(function () {
            count=$(this).find('.num_show').val()
            price=$(this).children('.col07').text()
            count=parseInt(count)
            price=parseFloat(price)
            totalcount1+=count
            totalprice1+=price
        })
        $('.settlements').children('.col03').children('em').text(totalprice1.toFixed(2))
        $('.settlements').children('.col03').children('b').text(totalcount1)
    }
    $('.settlements').find(':checkbox').change(function () {
        is_checked=$(this).prop('checked')
        $('.cart_list_td').find(':checkbox').each(function () {
            $(this).prop('checked',is_checked)
        })
        alert("点了")
        updateprice()
    });
    $('.cart_list_td').find(':checkbox').change(function () {
        boxlen=$('.cart_list_td').find(':checkbox').length
        ckedlen=$('.cart_list_td').find(':checked').length
        if (boxlen>ckedlen){
            $('.settlements').find(':checkbox').prop('checked',"")
        } else {
            $('.settlements').find(':checkbox').prop('checked',"checked")
        }
        updateprice()
    })
    $('.add').click(function () {
        $.ajaxSettings.async = false;
        count=$(this).next().val();
        count=parseInt(count)+1
        skuid=$(this).next().attr('skuid')
        parm={"skuid":skuid,"count":count}
        $.post("/goods/updateCart",parm,function (data) {
            if(data.code==5){
                alert(data.msg)
                $('.add').next()  .val(count)
                updateprice()
            }else {
                alert(data.msg)
            }
        })
    })

</script>